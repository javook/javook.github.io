# آموزش Jsp , Servlet


## انواع مدل های ارتباطی


**دو مدل ارتباطی** در زبان برنامه نویسی جاوا وجود دارد که شامل **Client (مشتری یا سرویس گیرنده) و Server (میزبان یا سرویس دهنده)** می باشند که هر دو **آدرس و شماره Port یکسانی** برای ایجاد ارتباط دارند. **Port**, کانال ارتباطی بین Client و server هست که توسط **سرور میزبان جهت مدیریت محتوای ارسالی** به سرویس گیرنده که مشتری است, بکار می رود. **درخواست مشتری (Request)** در قالب یک **Packet یا بسته** به وب سرور میزبان ارسال شده و پس از انجام عمل مربوطه, نتیجه بصورت **پاسخی (Response)** از طرف سرور به مشتری ارسال می شود. پورت های دارای اهمیت در این مبحث شامل **دو پروتکل لایه نرم افزاری Tcp-ip** می باشند که عبارتند از : **Http با پورت پیشفرض 80 و Https با پورت پیشفرض 443**. همچنین امکان تغییر پورت در هر دو پروتکل توسط **میزبان** وجود دارد بشرطی که مشتری یا سرویس گیرنده را از پورت جدید مطلع سازد.


## دسترسی مشتری به Web Aplication


**دسترسی مشتری به اپلیکیشن تحت وب** در وب سرور, با **ارائه یکی از دو پروتکل مذکور به همراه آدرس قرارگیری اپلیکیشن** توسط **سرویس دهنده** و **واردکردن آن در نوار آدرس مرورگر** توسط **مشتری** امکان پذیر است.این آدرس که **بعد از ذکر پروتکل** قرار می گیرد,ابتدا شامل **آدرس Ip یک فضای میزبانی در ماشین مجازی Virtual Machine Host** و یا **آدرس دامنه ای که بر روی فضای میزبان اینترنتی** خریداری شده می باشد. در ادامه پس از ذکر موارد یاد شده, **مسیری که وب اپلیکیشن توسط سرویس دهنده در وب سرور** قرار گرفته آورده می شود. نمونه کامل یک آدرس بصورت زیر می باشد :


Http://javahosting.ir/webapps/exmpleapp


## محتوای هر پروژه Web Aplication


 هر پروژه اپلیکیشن تحت وب شامل موارد زیر می باشد :

- **فایل های تنظیمات** اعم از **Xml ها و Properties**
- **کلاس ها** که همان فایل های جاوای کامپایل شده می باشند
- **کتابخانه ها** که مهم ترین آنها عبارتند از : **Jar و Jvm**
- **منابع کمکی یا Assest ها** که محل قرارگیری **تصاویر ,لوگو ها, فایل های Html,Css و از این قبیل** می باشند



## مفهوم Container در وب سرور


شامل **فیلتر ها , کتابخانه ها, کلاس ها و ابزار های مختلفی جهت میزبانی اپلیکیشن تحت وب** می باشند. گونه های زیادی از وب سرور ها برای میزبانی اپلیکیشن ها طراحی شدند که رایج ترین آن ها عبارتند از :

 Tomcat , Glassfish, Payara, Wildfly, Weblogic 

جهت استفاده از هر وب سرور, ابتدا باید فایل مربوطه را دانلود و از طریق terminal نصب نمود. همچنین در صورت **تنظیم نبودن JDK**, باید با واردکردن **دستور vim ~/.bashrc در terminal**, نسبت به تنظیم آن اقدام شود.


## کلاس های Servlet


**کلاس های طراحی شده به زبان جاوا** هستند که از **کلاس Servlet** جهت **مدیریت هر Request و Response مشتق (extends)شده** و متد های **Get و Post** آن کلاس را بازنویسی (Override)می کنند. همچنین با استفاده از برخی **فیلترهای Servlet** که یکی از مهم ترین آنها **<servlet-mapping>** می باشد , می توان مشخص کرد که هر Servlet تعریف شده **مسئول پاسخ گویی به کدام URL** است تا به عنوان مثال **کاربر به آن آدرس هدایت شود.**


## ایجاد یک Servlet 


 ابتدا **کلاس جاوای سرولت** نوشته می شود که طی آن ابتدا کلاس مورد نظر باید از **کلاس servlet ارث بری** کند سپس متد های **dopost و doget**آن پیاده سازی مجدد **override** شده و سایر تعاریف به همراه مقداردهی ها انجام گرفته و ذخیره می شود.در مرحله بعد سرولت ایجاد شده درون فایل **web.xml** پروژه بوسیله تگ های مخصوص تعریف می گردند.


## ایجاد یک صفحه Jsp


 ابتدا فایل Jsp که **مرکب از تگ ها و کد های جاوا** می باشد نوشته شده و ذخیره می شود و مانند سرولت در درون فایل **web.xml** پروژه بوسیله **تگ های مخصوصی** تعریف می شود.


## روش های نوشتن فایل Jsp


 برای نوشتن این نوع فایل, کتابخانه ای تحت عنوان **Jstl** طراحی شده است که شامل **مجموعه ای از تگ ها (tag library)** می باشد.این تگ ها به دسته های مختلفی تقسیم می شوند که عبارتند از :

1- **تگ های Core** : تگ های مخصوصی که از **متداول ترین ها** بوده و اکثرا از آنها استفاده می شوند. مانند  <C:set>

2- **تگ های Formatting** :مجموعه ای از تگ ها برای **فرمت دهی به آبجکت های مختلف**
 می باشد مانند اعداد,تاریخ و ساعت,متن. مانند <fmt:formatDate>

3- **تگ های Sql** : دسته ای از تگ های کاربردی برای **کار با دیتابیس و  اجرای Query ها** بکار می روند.مانند <sql:query>

4- **تگ های Xml** : این نوع تگ ها برای **کار با  فایل های Xml از جمله ایجاد و کار با آن ها** می باشند. تگ های مربوطه بین این **بلاک <%   %>** قرار می گیرند.همچنین **امکان تعریف آبجکت** در آن وجود دارد. مانند  <% int c=0 % >

5- **تگ های Functions** : این دسته تگ ها شامل **متد های آماده ای جهت کار با String ها** می باشند که **اکثرا با توابع کلاس String مشترک هستند** مانند ()fn:indexOf


## (زبان عبارتی)Expression Language 


جهت **انجام عملیات بر روی آبجکت های تعریف شده(متغیرها و متدها و ...) یا نمایش آنها** می باشد ولی **امکان تعریف هیچگونه آبجکتی را ندارد**. همچنین زبان عبارتی **شامل آبجکت های کاربردی آماده از جمله Param و Cookie** می باشد. کدهای مربوط به Expression Language درون این بلاک نوشته می شوند :      **{       }$**

در مثال زیر با استفاده از تگ jsp تنظیمی بنام box ایجاد شده که در آن **فرمول محاسبه محیط شکل در بلاک زبان عبارتی** درج گردیده است.

   <jsp:setProperty name = "box" property = "perimeter" 
   value = "${2*box.width+2*box.height}"/>

برای نمونه, **Functions ها در زبان عبارتی** به این صورت استفاده می شوند : 

**${fn:length("Get my length")}**


##  (محدوده ها)Scope ها در Jsp


1- **محدوده Page** : در این محدوده امکان **دسترسی به آبجکت(متغیر, متد و ...) فقط در همان صفحه ای که تعریف شده** ممکن می باشد. لازم به ذکر است که **آبجکت های Jsp ایجاد شده با تگ<jsp:useBean> بطور پیشفرض دارای سطح  Page** می باشند.

2- **محدوده Request** : این محدوده **یک سطح بالاتر از  Page** می باشد بطوریکه **امکان دسترسی به آبجکت علاوه بر صفحه ای که در آن تعریف شده در فقط یک صفحه دیگر** وجود دارد.

3- **محدوده Session** : سطح دسترسی این محدوده **بالاتر از Request** می باشد.در این سطح **امکان دسترسی به صفحه ای از برنامه و فقط صفحات مرتبط شده با آن در مدت محدود پیشفرض 30 دقیقه که قابل تغییر می باشد** وجود دارد که بعد از اتمام این زمان یا انجام موفق پردازش می توان کاربر را به صفحه ای جدید هدایت redirect کرد.

4- **محدوده Application** : این محدوده دارای **بالاترین سطح دسترسی** است که طی آن **امکان دستیابی و استفاده از همه صفحات** بدون محدودیت وجود دارد.

















